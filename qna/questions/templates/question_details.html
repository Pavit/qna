{% extends "base.html" %}

{% block question_details %}
{% load staticfiles %}

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function() {
  pageurl = "{% url question_details question.id %}"
  window.history.pushState({path:pageurl},'',pageurl);
});
</script>

  <meta http-equiv="content-type" content="text/html; charset=UTF8">
  <link rel="stylesheet" href="{% static 'stylesheets/poll.css' %}" />

<h3>Sunburst Charts</h3>
<form>
    <label>Please select the question</label>
    <select name="question" id="question">
        {% for q in allquestions %}
        <option value="{{q.pk}}">Question {{q.pk}}</option>
        {% endfor %}
    </select>
</form>
<div class="pollChart" id="sunburst"></div>
<script src="{% static 'javascripts/vendor/d3.js' %}"></script>
<script src="{% static 'javascripts/vendor/underscore.js' %}"></script>
<script src="{% static 'javascripts/chart.js' %}"></script>
<script>
    (function(){
        var pollChart = window.pollChart;
        d3.select("form select").on("change", function() {
            console.log(this.options[this.selectedIndex].value);
            url = "/questions/getjson/"+this.options[this.selectedIndex].value+"/";
            pollChart.showSunburst(url);
        });
        pollChart.showSunburst('{% url getjson question.id %}');

    })();

</script>


{% endblock question_details %}